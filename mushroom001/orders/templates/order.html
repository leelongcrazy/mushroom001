{% extends "base.html" %}
{% load static %}

{% block title %}
Order
{% endblock %}

{% block script %}
<script src="{% static 'js/order.js' %}"></script>
{% endblock %}

{% block nav_list %}
<li><a href="{% url 'prod' %}">产品</a></li>
<li><a href="{% url 'cart' %}">购物车</a></li>
<li class=""><a href="{% url 'orders_view' %}">订单</a></li>
<li class="active"><a href="{% url 'order_view' Oid=order.id %}">单号 {{ order.order_id }}</a></li>
{% endblock %}

{% block disp %}
<h2>订单号： {{ order.order_id }}</h2>

<form id="modify_order" action="{% url 'order_view' Oid=order.id %}" method="post">
{% csrf_token %}
{% if items|length > 0 %}
    <table class="table table-striped table-hover table-responsive" cellspacing="0">
        <thead>
            <th width="50%" colspan="2">产品名称</th>
            <th width="10%">数  量</th>
            <th width="10%">单  价</th>
            <th width="15%">创建时间</th>
            <th width="15%">更新时间</th>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td width="50%" colspan="2">
                    <span data-toggle="tooltip" title="￥{{ item.product.price }}/serving">
                        <strong>{{ item.product.category }}</strong> - {{ item.product.name}} ({{ item.product.quantity }})
                    </span>
                </td>
                <td width="10%">
                    <input id="product_{{ item.id }}" name="product_{{ item.id }}" data-class="qty" data-item="{{ item.id }}" 
                     type="number" min="0" style="width:50%" value="{{ item.quantity }}" 
                     {% if order.order_status != 'Pending' %}readonly{% endif %} />
                </td>
                <td width="10%">
                    ￥<span id="product_price_{{ item.id }}" name="product_price_{{ item.id }}" data-class="price" 
                      data-item="{{ item.id }}">{{ item.price }}</span>
                </td>
                <td width="15%">{{ item.create_time|date:"Y/m/d H:i:s" }}</td>
                <td width="15%">{{ item.update_time|date:"Y/m/d H:i:s" }}</td>
            </tr>
            
            {% if item.topping.all|length > 0 %}
                {% for topping in item.itemtopping_item.all %}
                <tr>
                    <td width="10%"></td>
                    <td width="40%">
                        <span data-toggle="tooltip" title="￥{{ topping.topping.price }}/serving">
                            <span style="color:#bbb">+Topping:</span> {{ topping.topping.name }} x {{ topping.quantity }}
                        </span>
                    </td>
                    <td width="10%"></td>
                    <td width="10%"></td>
                    <td width="15%"></td>
                    <td width="15%"></td>
                </tr>
                {% endfor %}
            {% endif %}
            {% if item.addition.all|length > 0 %}
                {% for addition in item.itemaddition_item.all %}
                <tr>
                    <td width="10%"></td>
                    <td width="40%">
                        <span data-toggle="tooltip" title="￥{{ addition.addition.price }}/serving">
                            <span style="color:#bbb">+Addition:</span> {{ addition.addition.name }} ({{ addition.addition.size }}) x {{ addition.quantity }}
                        </span>
                    </td>
                    <td width="10%"></td>
                    <td width="10%"></td>
                    <td width="15%"></td>
                    <td width="15%"></td>
                </tr>
                {% endfor %}
            {% endif %}

            {% endfor %}
        </tbody>
    </table>
{% else %}
<p>No items found.</p>
{% endif %}

<hr>
<div class="container">
    <div class="row">
        <div class="col-lg-8 col-md-8 col-sm-0"></div>
        <div class="col-lg-1 col-md-1 col-sm-4"><h4>Status: </h4></div>
        <div class="col-lg-3 col-md-3 col-sm-8">
            <h4 style="text-align:right;font-weight:bold">
                <span id="status" class=
                    {% if order.order_status == '0' %}"text-success bg-success"
                    {% elif order.order_status == '1' %}"text-info bg-info"
                    {% elif order.order_status == '2' %}"text-danger bg-danger"
                    {% elif order.order_status == '3' %}"text-muted"
                    {% elif order.order_status == '4' %}"text-muted"
                    {% elif order.order_status == '5' %}"bg-primary"
                    {% endif %}>{{ order.get_order_status_display }}
                </span>
            </h4>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-8 col-md-8 col-sm-0"></div>
        <div class="col-lg-1 col-md-1 col-sm-4"><h4>Created: </h4></div>
        <div class="col-lg-3 col-md-3 col-sm-8">
            <h4 style="text-align:right"><span>{{ order.create_time|date:"Y/m/d H:i:s" }}</span></h4>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-8 col-md-8 col-sm-0"></div>
        <div class="col-lg-1 col-md-1 col-sm-4"><h4>Updated: </h4></div>
        <div class="col-lg-3 col-md-3 col-sm-8">
            <h4 style="text-align:right"><span>{{ order.update_time|date:"Y/m/d H:i:s" }}</span></h4>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-8 col-md-8 col-sm-0"></div>
        <div class="col-lg-1 col-md-1 col-sm-4"><h4>Total: </h4></div>
        <div class="col-lg-3 col-md-3 col-sm-8">
            <h4 style="text-align:right;font-weight:bold">￥<span id="total_price">{{ cart_sum }}</span></h4>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-8 col-md-6 col-sm-0"></div>
        <div class="col-lg-2 col-md-3 col-sm-6">
            <button id="btn_save" name="btn_save" value="{{ order.order_id }}" type="submit" class="btn btn-secondary btn-block"
            {% if order.order_status != 'Pending' %}
                disabled="disabled" 
            {% endif %}>Save</button>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-6">
            <button id="btn_pay" name="btn_pay" value="{{ order.order_id }}" type="submit" class="btn btn-primary btn-block"
            {% if order.order_status == 'Paid' or order.order_status == 'Completed' or order.order_status == 'Cancelled' %}
                disabled="disabled" 
            {% endif %}>Pay</button>
        </div>
    </div>
    <div class="col-12">&nbsp;</div>
    <div class="row">
        <div class="col-lg-8 col-md-6 col-sm-0"></div>
        <div class="col-lg-2 col-md-3 col-sm-6">
            <button id="btn_cancel" name="btn_cancel" value="{{ order.order_id }}" type="submit" class="btn btn-warning btn-block"
            {% if order.order_status == 'Paid' or order.order_status == 'Cancelled' %}
                disabled="disabled" 
            {% endif %}>Cancel</button>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-6">
            <button id="btn_delete" name="btn_delete" value="{{ order.order_id }}" type="submit" class="btn btn-danger btn-block"
            {% if order.order_status == 'Paid' or order.order_status == 'Completed' %}
                disabled="disabled" 
            {% endif %}>Delete</button>
        </div>
    </div>
</div>

</form>
{% endblock disp %}

