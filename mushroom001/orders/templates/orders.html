{% extends "base.html" %}
{% load static %}

{% block title %}
订单管理
{% endblock %}

{% block script %}
<script src="{% static 'js/orders.js' %}"></script>
{% endblock %}

{% block nav_list %}
<li><a href="{% url 'prod' %}">产品</a></li>
<li><a href="{% url 'cart' %}">购物车</a></li>
<li class="active"><a href="{% url 'orders_view' %}">订单</a></li>
{% endblock %}

{% block disp %}
<form id="submit_orders" action="{% url 'orders_view' %}" method="post">
{% csrf_token %}

{% if orders|length > 0 %}
    <table class="table table-striped table-hover table-responsive" cellspacing="0">
        <thead>
            <tr>
                <th width="15%">
                    <input type="checkbox" name="check_all" id="check_all">订单编号</input>
                </th>
                <th width="10%">收货人</th>
                <th width="15%">总价</th>
                <th width="10%">订单状态</th>
                <th width="15%">创建时间</th>
                <th width="15%">更新时间</th>
                <th width="auto" class="text-right">
{#                    <button name="btn_pay" type="submit" id="btn_pay" class="btn btn-primary btn-sm">Pay</button>&nbsp;#}
{#                    <button name="btn_cancel" type="submit" id="btn_cancel" class="btn btn-warning btn-sm">Cancel</button>&nbsp;#}
{#                    <button name="btn_delete" type="submit" id="btn_delete" class="btn btn-danger btn-sm">Delete</button>#}
                </th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <th width="15%">
                    <input type="checkbox" name="order_{{ order.order_id }}" data-class="order" data-item="{{ order.order_id }}" value="{{ order.total_price }}">
{#                        <a href="{% url 'order_view' Oid=order.id %}">#{{ order.order_id }}</a>#}
                        <a href="{% url 'order_view' Oid=order.id %}">{{ order.order_id }}</a>
                    </input>
                </th>
                <td width="10%" id="qty_{{ order.order_id }}">{{ order.to_user }}</td>
                <td width="15%">￥<span id="price_{{ order.order_id }}">{{ order.total_price }}</span></td>
                <td width="10%" id="status_{{ order.order_id }}">
                    <span class=
                        {% if order.order_status == '0' %}"text-success"
                        {% elif order.order_status == '1' %}"text-info"
                        {% elif order.order_status == '2' %}"text-danger"
                        {% elif order.order_status == '3' %}"text-muted"
                        {% elif order.order_status == '4' %}"text-muted"
                        {% elif order.order_status == '5' %}"text-primary"
                        {% endif %}>{{ order.get_order_status_display }}
                    </span>
                </td>
                <td width="15%">
                    {{ order.create_time|date:"Y-m-d" }}
                </td>
                <td width="15%">
                    {{ order.update_time|date:"Y-m-d" }}
                </td>
                <td width="auto" class="text-right">
                    <button name="pay" value="{{ order.order_id }}" class="btn btn-primary btn-sm"
                     {% if order.order_status == 'Paid' or order.order_status == 'Completed' or order.order_status == 'Cancelled' %}
                      disabled="disabled"
                     {% endif %}>Pay</button>&nbsp;
                    <button name="cancel" value="{{ order.order_id }}" class="btn btn-warning btn-sm"
                     {% if order.order_status == 'Paid' or order.order_status == 'Cancelled' %}
                      disabled="disabled"
                     {% endif %}>Cancel</button>&nbsp;
                    <button name="delete" value="{{ order.order_id }}" class="btn btn-danger btn-sm"
                     {% if order.order_status == 'Paid' or order.order_status == 'Completed' %}
                      disabled="disabled"
                     {% endif %}>Delete</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

{% else %}
<p>No items found.</p>
{% endif %}
{% if orders|length > 1 %}
<div>
    <nav>
        <ul>
            <li>
                {% if orders.has_previous %}
                <a class="active" href="?page={{ orders.previous_page_number }}">上一页</a>
                {% endif %}
            <span>
                Page {{ orders.number }} of {{ orders.paginator.num_pages }}
            </span>
                {% if orders.has_next %}
                <a class="active" href="?page={{ orders.next_page_number }}">下一页</a>
                {% endif %}
            </li>
        </ul>
    </nav>
</div>
{% endif %}
<hr>
<div class="container">
    <div class="row">
        <div class="col-lg-9 col-md-8"></div>
        <div class="col-lg-1 col-md-1 col-sm-4">
            <h4>Selected: </h4>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-8">
            <h4 style="text-align:right;font-weight:bold">￥<span id="select_price">{{ select_sum }}</span></h4>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-9 col-md-8"></div>
        <div class="col-lg-1 col-md-1 col-sm-4">
            <h4>Total: </h4>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-8">
            <h4 style="text-align:right;font-weight:bold">￥<span id="total_price">{{ cart_sum }}</span></h4>
        </div>
    </div>
</div>
</form>
{% endblock disp %}

